version: 2
machine:
   timezone: America/New_York
   java:
      version: openjdk8
   services:
      - docker

dependencies:
   post:
      - docker info
    
test:
   override:
      - ./gradlew build
   post:
      - docker build --rm=false -t lucksolutions/microservice-ref .
      - docker run -d -p 80:80 lucksolutions/microservice-ref; sleep 10
      - curl --retry 10 --retry-delay 5 -v http://localhost/health


deployment:
   hub:
      branch: master
      commands:
         - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
         - docker push lucksolutions/microservice-ref